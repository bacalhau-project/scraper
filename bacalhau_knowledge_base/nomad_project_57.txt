URL: https://www.nomadproject.io/docs/internals/plugins/devices

HashiDaysOne conference. Three cities.Find a city near youDismiss alertHashiCorp DeveloperHashiCorp Cloud PlatformTerraformPackerConsulVaultBoundaryNomadWaypointVagrantNomadInstallIntroTutorialsDocumentationAPIToolsPluginsIntegrationsSearchCommand or control keyK keySign inSign upThemeNomad HomeDocumentationDocumentationInstall NomadUpgradingRelease NotesIntegrationsConceptsOverviewACLArchitectureCPUPluginsOverviewBaseTask DriversDevicesStorageNetworkingSchedulingConsensus ProtocolFilesystemGossip ProtocolNode PoolsSecurity ModelWorkload IdentityVariablesConfigurationCommands (CLI)GlossaryJob SpecificationOther SpecificationsTask DriversDevice PluginsSchedulersRuntimeNetworkingAutoscalingOperationsNomad vs. KubernetesNomad EcosystemNomad PartnershipsWho Uses NomadNomad EnterpriseFAQResourcesTutorial LibraryCommunity Forum(opens in new tab)Support(opens in new tab)GitHub(opens in new tab)DeveloperNomadDocumentationConceptsPluginsDevicesv1.8.x (latest)Nomadv1.7.xv1.6.xv1.5.xv1.4.xv1.3.xv1.2.xv1.1.xDevicesNomad has built-in support for scheduling compute resources such as CPU, memory,
and networking. Nomad device plugins are used to support scheduling tasks with
other devices, such as GPUs. They are responsible for fingerprinting these
devices and working with the Nomad client to make them available to assigned
tasks.For a real world example of a Nomad device plugin implementation, see theNvidia
GPU plugin.Authoring Device PluginsAuthoring a device plugin in Nomad consists of implementing theDevicePlugininterface alongside
a main package to launch the plugin.Thedevice plugin skeleton projectexists to help bootstrap
the development of new device plugins. It provides most of the boilerplate
necessary for a device plugin, along with detailed comments.Lifecycle and StateA device plugin is long-lived. Nomad will ensure that one instance of the plugin is
running. If the plugin crashes or otherwise terminates, Nomad will launch another
instance of it.However, unliketask drivers, device plugins do not currently
have an interface for persisting state to the Nomad client. Instead, the device
plugin API emphasizes fingerprinting devices and reporting their status. After
helping to provision a task with a scheduled device, a device plugin does not
have any responsibility (or ability) to monitor the task.Device Plugin APIThebase pluginmust be implemented in addition to the following
functions.Fingerprint(context.Context) (<-chan *FingerprintResponse, error)TheFingerprintfunctionis called by the client when the plugin is started.
It allows the plugin to provide Nomad with a list of discovered devices, along with their
attributes, for the purpose of scheduling workloads using devices.
The channel returned should immediately send an initialFingerprintResponse, then send periodic updates at
an appropriate interval until the context is canceled.Each fingerprint response consists of either an error or a list of device groups.
A device group is a list of detected devices that are identical for the purpose of
scheduling; that is, they will have identical attributes.Stats(context.Context, time.Duration) (<-chan *StatsResponse, error)TheStatsfunctionreturns a channel on which the plugin should
emit device statistics, at the specified interval, until either an error is
encountered or the specified context is cancelled. TheStatsReponseobject
allowsdimensionedstatistics to be returned for each device in a device group.Reserve(deviceIDs []string) (*ContainerReservation, error)TheReservefunctionaccepts a list of device IDs and returns the information
necessary for the client to make those devices available to a task. Currently,
theContainerReservationobject allows the plugin to specify environment
variables for the task, as well as a list of host devices and files to be mounted
into the task's filesystem. Any orchestration required to prepare the device for
use should also be performed in this function.Edit this page on GitHubOn this page:DevicesAuthoring Device PluginsDevice Plugin APIThemeCertificationsSystem StatusCookie ManagerTerms of UseSecurityPrivacyTrademark PolicyTrade ControlsAccessibilityGive Feedback(opens in new tab)